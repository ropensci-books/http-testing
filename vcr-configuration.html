<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 24 Configure vcr | HTTP testing in R</title>
<meta name="author" content="Scott Chamberlain, MaÃ«lle Salmon">
<meta name="description" content='library("vcr") You can also get the default configuration variables via vcr_config_defaults() vcr_config_defaults() #&gt; $warn_on_empty_cassette #&gt; [1] TRUE #&gt; #&gt; $quiet #&gt; [1] TRUE #&gt; #&gt;...'>
<meta name="generator" content="bookdown 0.40 with bs4_book()">
<meta property="og:title" content="Chapter 24 Configure vcr | HTTP testing in R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://books.ropensci.org/http-testing/vcr-configuration.html">
<meta property="og:description" content='library("vcr") You can also get the default configuration variables via vcr_config_defaults() vcr_config_defaults() #&gt; $warn_on_empty_cassette #&gt; [1] TRUE #&gt; #&gt; $quiet #&gt; [1] TRUE #&gt; #&gt;...'>
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 24 Configure vcr | HTTP testing in R">
<meta name="twitter:description" content='library("vcr") You can also get the default configuration variables via vcr_config_defaults() vcr_config_defaults() #&gt; $warn_on_empty_cassette #&gt; [1] TRUE #&gt; #&gt; $quiet #&gt; [1] TRUE #&gt; #&gt;...'>
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.8.0/transition.js"></script><script src="libs/bs3compat-0.8.0/tabs.js"></script><script src="libs/bs3compat-0.8.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><div class="inline-figure"><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></div></noscript>
<!-- End Matomo Code --><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">HTTP testing in R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Preamble</a></li>
<li class="book-part">Introduction</li>
<li><a class="" href="http-in-r-101.html"><span class="header-section-number">2</span> HTTP in R 101</a></li>
<li><a class="" href="graceful.html"><span class="header-section-number">3</span> Graceful HTTP R packages</a></li>
<li><a class="" href="pkgs-testing-chapter.html"><span class="header-section-number">4</span> Packages for HTTP testing</a></li>
<li class="book-part">Whole Game(s)</li>
<li><a class="" href="introduction.html"><span class="header-section-number">5</span> Introduction</a></li>
<li><a class="" href="vcr.html"><span class="header-section-number">6</span> Use vcr (&amp; webmockr)</a></li>
<li><a class="" href="httptest.html"><span class="header-section-number">7</span> Use httptest</a></li>
<li><a class="" href="mocking-pkgs-comparison.html"><span class="header-section-number">8</span> vcr and httptest</a></li>
<li><a class="" href="httptest2.html"><span class="header-section-number">9</span> Use httptest2</a></li>
<li><a class="" href="webfakes.html"><span class="header-section-number">10</span> Use webfakes</a></li>
<li><a class="" href="pkgs-comparison.html"><span class="header-section-number">11</span> vcr (&amp; webmockr), httptest, webfakes</a></li>
<li class="book-part">Advanced Topics</li>
<li><a class="" href="real-requests-chapter.html"><span class="header-section-number">12</span> Making real requests</a></li>
<li><a class="" href="cran-preparedness.html"><span class="header-section-number">13</span> CRAN- (and Bioconductor) preparedness for your tests</a></li>
<li><a class="" href="security-chapter.html"><span class="header-section-number">14</span> Security</a></li>
<li><a class="" href="errors-chapter.html"><span class="header-section-number">15</span> Faking HTTP errors</a></li>
<li><a class="" href="contributor-friendliness.html"><span class="header-section-number">16</span> Contributor friendliness</a></li>
<li class="book-part">Conclusion</li>
<li><a class="" href="conclusion-5.html"><span class="header-section-number">17</span> Conclusion</a></li>
<li class="book-part">webmockr details</li>
<li><a class="" href="mocking.html"><span class="header-section-number">18</span> Mocking HTTP Requests</a></li>
<li><a class="" href="webmockr-stubs.html"><span class="header-section-number">19</span> stubs</a></li>
<li><a class="" href="webmockr-testing.html"><span class="header-section-number">20</span> testing</a></li>
<li><a class="" href="webmockr-utilities.html"><span class="header-section-number">21</span> utilities</a></li>
<li class="book-part">vcr details</li>
<li><a class="" href="vcr-intro.html"><span class="header-section-number">22</span> Caching HTTP requests</a></li>
<li><a class="" href="vcr-usage.html"><span class="header-section-number">23</span> Advanced vcr usage</a></li>
<li><a class="active" href="vcr-configuration.html"><span class="header-section-number">24</span> Configure vcr</a></li>
<li><a class="" href="record-modes.html"><span class="header-section-number">25</span> Record modes</a></li>
<li><a class="" href="request-matching.html"><span class="header-section-number">26</span> Request matching</a></li>
<li><a class="" href="debugging-your-tests-that-use-vcr.html"><span class="header-section-number">27</span> Debugging your tests that use vcr</a></li>
<li><a class="" href="vcr-security.html"><span class="header-section-number">28</span> Security with vcr</a></li>
<li><a class="" href="lightswitch.html"><span class="header-section-number">29</span> Turning vcr on and off</a></li>
<li><a class="" href="managing-cassettes.html"><span class="header-section-number">30</span> Managing cassettes</a></li>
<li><a class="" href="gotchas.html"><span class="header-section-number">31</span> Gotchas</a></li>
<li><a class="" href="session-info.html"><span class="header-section-number">32</span> Session info</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/ropensci-books/http-testing">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="vcr-configuration" class="section level1" number="24">
<h1>
<span class="header-section-number">24</span> Configure vcr<a class="anchor" aria-label="anchor" href="#vcr-configuration"><i class="fas fa-link"></i></a>
</h1>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/vcr">"vcr"</a></span><span class="op">)</span></span></code></pre></div>
<p>You can also get the default configuration variables via <code><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_config_defaults()</a></code></p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_config_defaults</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; $warn_on_empty_cassette
#&gt; [1] TRUE
#&gt; 
#&gt; $quiet
#&gt; [1] TRUE
#&gt; 
#&gt; $verbose_errors
#&gt; [1] FALSE
#&gt; 
#&gt; $write_disk_path
#&gt; NULL
#&gt; 
#&gt; $filter_query_parameters
#&gt; NULL
#&gt; 
#&gt; $filter_response_headers
#&gt; NULL
#&gt; 
#&gt; $filter_request_headers
#&gt; NULL
#&gt; 
#&gt; $filter_sensitive_data_regex
#&gt; NULL
#&gt; 
#&gt; $filter_sensitive_data
#&gt; NULL
#&gt; 
#&gt; $log_opts
#&gt; $log_opts$file
#&gt; [1] "vcr.log"
#&gt; 
#&gt; $log_opts$log_prefix
#&gt; [1] "Cassette"
#&gt; 
#&gt; $log_opts$date
#&gt; [1] TRUE
#&gt; 
#&gt; 
#&gt; $log
#&gt; [1] FALSE
#&gt; 
#&gt; $linked_context
#&gt; NULL
#&gt; 
#&gt; $cassettes
#&gt; list()
#&gt; 
#&gt; $allow_http_connections_when_no_cassette
#&gt; [1] FALSE
#&gt; 
#&gt; $clean_outdated_http_interactions
#&gt; [1] FALSE
#&gt; 
#&gt; $re_record_interval
#&gt; NULL
#&gt; 
#&gt; $turned_off
#&gt; [1] FALSE
#&gt; 
#&gt; $preserve_exact_body_bytes
#&gt; [1] FALSE
#&gt; 
#&gt; $uri_parser
#&gt; [1] "crul::url_parse"
#&gt; 
#&gt; $ignore_request
#&gt; NULL
#&gt; 
#&gt; $ignore_localhost
#&gt; [1] FALSE
#&gt; 
#&gt; $ignore_hosts
#&gt; NULL
#&gt; 
#&gt; $persist_with
#&gt; [1] "FileSystem"
#&gt; 
#&gt; $json_pretty
#&gt; [1] FALSE
#&gt; 
#&gt; $serialize_with
#&gt; [1] "yaml"
#&gt; 
#&gt; $allow_unused_http_interactions
#&gt; [1] TRUE
#&gt; 
#&gt; $match_requests_on
#&gt; [1] "method" "uri"   
#&gt; 
#&gt; $record
#&gt; [1] "once"
#&gt; 
#&gt; $dir
#&gt; [1] "."</code></pre>
<p>These defaults are set when you load <code>vcr</code> - you can override any of them as described below.</p>
<div id="set-configuration-variables" class="section level2" number="24.1">
<h2>
<span class="header-section-number">24.1</span> Set configuration variables<a class="anchor" aria-label="anchor" href="#set-configuration-variables"><i class="fas fa-link"></i></a>
</h2>
<p>Use <code><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure()</a></code> to set configuration variables.</p>
<p>For example, set a single variable:</p>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span></span>
<span>  dir <span class="op">=</span> <span class="st">"foobar/vcr_cassettes"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; &lt;vcr configuration&gt;
#&gt;   Cassette Dir: foobar/vcr_cassettes
#&gt;   Record: once
#&gt;   Serialize with: yaml
#&gt;   URI Parser: crul::url_parse
#&gt;   Match Requests on: method, uri
#&gt;   Preserve Bytes?: FALSE
#&gt;   Logging?: FALSE
#&gt;   ignored hosts: 
#&gt;   ignore localhost?: FALSE
#&gt;   Write disk path:</code></pre>
<p>Or many at once:</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span></span>
<span>  dir <span class="op">=</span> <span class="st">"foobar/vcr_cassettes"</span>,</span>
<span>  record <span class="op">=</span> <span class="st">"all"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; &lt;vcr configuration&gt;
#&gt;   Cassette Dir: foobar/vcr_cassettes
#&gt;   Record: all
#&gt;   Serialize with: yaml
#&gt;   URI Parser: crul::url_parse
#&gt;   Match Requests on: method, uri
#&gt;   Preserve Bytes?: FALSE
#&gt;   Logging?: FALSE
#&gt;   ignored hosts: 
#&gt;   ignore localhost?: FALSE
#&gt;   Write disk path:</code></pre>
</div>
<div id="re-set-to-defaults" class="section level2" number="24.2">
<h2>
<span class="header-section-number">24.2</span> Re-set to defaults<a class="anchor" aria-label="anchor" href="#re-set-to-defaults"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure_reset</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="details-on-some-of-the-config-options" class="section level2" number="24.3">
<h2>
<span class="header-section-number">24.3</span> Details on some of the config options<a class="anchor" aria-label="anchor" href="#details-on-some-of-the-config-options"><i class="fas fa-link"></i></a>
</h2>
<div id="dir" class="section level3" number="24.3.1">
<h3>
<span class="header-section-number">24.3.1</span> dir<a class="anchor" aria-label="anchor" href="#dir"><i class="fas fa-link"></i></a>
</h3>
<p>Directory where cassettes are stored</p>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="st">"new/path"</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; &lt;vcr configuration&gt;
#&gt;   Cassette Dir: new/path
#&gt;   Record: once
#&gt;   Serialize with: yaml
#&gt;   URI Parser: crul::url_parse
#&gt;   Match Requests on: method, uri
#&gt;   Preserve Bytes?: FALSE
#&gt;   Logging?: FALSE
#&gt;   ignored hosts: 
#&gt;   ignore localhost?: FALSE
#&gt;   Write disk path:</code></pre>
</div>
<div id="record" class="section level3" number="24.3.2">
<h3>
<span class="header-section-number">24.3.2</span> record<a class="anchor" aria-label="anchor" href="#record"><i class="fas fa-link"></i></a>
</h3>
<p>The record mode</p>
<p>One of: âallâ, ânoneâ, ânew_episodesâ, âonceâ. See <code><a href="https://docs.ropensci.org/vcr/reference/recording.html">?recording</a></code> for info on the options</p>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span>record <span class="op">=</span> <span class="st">"new_episodes"</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; &lt;vcr configuration&gt;
#&gt;   Cassette Dir: new/path
#&gt;   Record: new_episodes
#&gt;   Serialize with: yaml
#&gt;   URI Parser: crul::url_parse
#&gt;   Match Requests on: method, uri
#&gt;   Preserve Bytes?: FALSE
#&gt;   Logging?: FALSE
#&gt;   ignored hosts: 
#&gt;   ignore localhost?: FALSE
#&gt;   Write disk path:</code></pre>
</div>
<div id="match_requests_on" class="section level3" number="24.3.3">
<h3>
<span class="header-section-number">24.3.3</span> match_requests_on<a class="anchor" aria-label="anchor" href="#match_requests_on"><i class="fas fa-link"></i></a>
</h3>
<p>Customize how <code>vcr</code> matches requests</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span>match_requests_on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'query'</span>, <span class="st">'headers'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; &lt;vcr configuration&gt;
#&gt;   Cassette Dir: new/path
#&gt;   Record: new_episodes
#&gt;   Serialize with: yaml
#&gt;   URI Parser: crul::url_parse
#&gt;   Match Requests on: query, headers
#&gt;   Preserve Bytes?: FALSE
#&gt;   Logging?: FALSE
#&gt;   ignored hosts: 
#&gt;   ignore localhost?: FALSE
#&gt;   Write disk path:</code></pre>
</div>
<div id="allow_unused_http_interactions" class="section level3" number="24.3.4">
<h3>
<span class="header-section-number">24.3.4</span> allow_unused_http_interactions<a class="anchor" aria-label="anchor" href="#allow_unused_http_interactions"><i class="fas fa-link"></i></a>
</h3>
<p>Allow HTTP connections when no cassette</p>
<p>Default is <code>TRUE</code>, and thus does not error when http interactions are unused. You
can set to <code>FALSE</code> in which case vcr errors when a cassette is ejected and
not all http interactions have been used.</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span>allow_unused_http_interactions <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; &lt;vcr configuration&gt;
#&gt;   Cassette Dir: new/path
#&gt;   Record: new_episodes
#&gt;   Serialize with: yaml
#&gt;   URI Parser: crul::url_parse
#&gt;   Match Requests on: query, headers
#&gt;   Preserve Bytes?: FALSE
#&gt;   Logging?: FALSE
#&gt;   ignored hosts: 
#&gt;   ignore localhost?: FALSE
#&gt;   Write disk path:</code></pre>
</div>
<div id="serialize_with" class="section level3" number="24.3.5">
<h3>
<span class="header-section-number">24.3.5</span> serialize_with<a class="anchor" aria-label="anchor" href="#serialize_with"><i class="fas fa-link"></i></a>
</h3>
<p>Which serializer to use: âyamlâ or âjsonâ. Note that you can have
multiple cassettes with the same name as long as they use different
serializers; so if you only want one cassette for a given cassette name,
make sure to not switch serializers, or clean up files you no longer need.</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span>serialize_with <span class="op">=</span> <span class="st">"yaml"</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; &lt;vcr configuration&gt;
#&gt;   Cassette Dir: new/path
#&gt;   Record: new_episodes
#&gt;   Serialize with: yaml
#&gt;   URI Parser: crul::url_parse
#&gt;   Match Requests on: query, headers
#&gt;   Preserve Bytes?: FALSE
#&gt;   Logging?: FALSE
#&gt;   ignored hosts: 
#&gt;   ignore localhost?: FALSE
#&gt;   Write disk path:</code></pre>
</div>
<div id="persist_with" class="section level3" number="24.3.6">
<h3>
<span class="header-section-number">24.3.6</span> persist_with<a class="anchor" aria-label="anchor" href="#persist_with"><i class="fas fa-link"></i></a>
</h3>
<p>Which persister to use. Right now only option is âFileSystemâ</p>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span>persist_with <span class="op">=</span> <span class="st">"FileSystem"</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; &lt;vcr configuration&gt;
#&gt;   Cassette Dir: new/path
#&gt;   Record: new_episodes
#&gt;   Serialize with: yaml
#&gt;   URI Parser: crul::url_parse
#&gt;   Match Requests on: query, headers
#&gt;   Preserve Bytes?: FALSE
#&gt;   Logging?: FALSE
#&gt;   ignored hosts: 
#&gt;   ignore localhost?: FALSE
#&gt;   Write disk path:</code></pre>
</div>
<div id="ignoring-some-requests" class="section level3" number="24.3.7">
<h3>
<span class="header-section-number">24.3.7</span> ignoring some requests<a class="anchor" aria-label="anchor" href="#ignoring-some-requests"><i class="fas fa-link"></i></a>
</h3>
<p><strong>ignore_hosts</strong></p>
<p>Specify particular hosts to ignore. By ignore, we mean that
real HTTP requests to the ignored host will be allowed to occur, while
all others will not.</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span>ignore_hosts <span class="op">=</span> <span class="st">"google.com"</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; &lt;vcr configuration&gt;
#&gt;   Cassette Dir: new/path
#&gt;   Record: new_episodes
#&gt;   Serialize with: yaml
#&gt;   URI Parser: crul::url_parse
#&gt;   Match Requests on: query, headers
#&gt;   Preserve Bytes?: FALSE
#&gt;   Logging?: FALSE
#&gt;   ignored hosts: google.com
#&gt;   ignore localhost?: FALSE
#&gt;   Write disk path:</code></pre>
<p><strong>ignore_localhost</strong></p>
<p>Ignore all localhost requests</p>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span>ignore_localhost <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; &lt;vcr configuration&gt;
#&gt;   Cassette Dir: new/path
#&gt;   Record: new_episodes
#&gt;   Serialize with: yaml
#&gt;   URI Parser: crul::url_parse
#&gt;   Match Requests on: query, headers
#&gt;   Preserve Bytes?: FALSE
#&gt;   Logging?: FALSE
#&gt;   ignored hosts: google.com
#&gt;   ignore localhost?: TRUE
#&gt;   Write disk path:</code></pre>
<p><strong>ignore_request</strong></p>
<p>THIS DOESNâT WORK YET</p>
<p><strong>How to ignore requests</strong></p>
<p>For ignoring requests, you can for example, have real http requests go through (ignored by <code>vcr</code>) while other requests are handled by <code>vcr</code>. For example, letâs say you want requests to <code>google.com</code> to be ignored:</p>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span>ignore_hosts <span class="op">=</span> <span class="st">"google.com"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/use_cassette.html">use_cassette</a></span><span class="op">(</span><span class="st">"foo_bar"</span>, <span class="op">{</span></span>
<span>  <span class="fu">crul</span><span class="fu">::</span><span class="va"><a href="https://docs.ropensci.org/crul/reference/HttpClient.html">HttpClient</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"https://httpbin.org/get"</span><span class="op">)</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu">crul</span><span class="fu">::</span><span class="va"><a href="https://docs.ropensci.org/crul/reference/HttpClient.html">HttpClient</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"https://google.com"</span><span class="op">)</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>The request to httpbin.org will be handled by <code>vcr</code>, a cassette created for the request/response to that url, while the google.com request will be ignored and not cached at all.</p>
<p>Note: ignoring requests only works for the <code>crul</code> package for now; it should work for <code>httr</code> and <code>httr2</code> in a later <code>vcr</code> version.</p>
</div>
<div id="uri_parse" class="section level3" number="24.3.8">
<h3>
<span class="header-section-number">24.3.8</span> uri_parse<a class="anchor" aria-label="anchor" href="#uri_parse"><i class="fas fa-link"></i></a>
</h3>
<p>Which uri parser to use</p>
<p>By default we use <code><a href="https://docs.ropensci.org/crul/reference/url_build.html">crul::url_parse</a></code>, but you can use a different one. Remember
to pass in the function quoted, and namespaced.</p>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span>uri_parser <span class="op">=</span> <span class="st">"urltools::url_parse"</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; &lt;vcr configuration&gt;
#&gt;   Cassette Dir: new/path
#&gt;   Record: new_episodes
#&gt;   Serialize with: yaml
#&gt;   URI Parser: urltools::url_parse
#&gt;   Match Requests on: query, headers
#&gt;   Preserve Bytes?: FALSE
#&gt;   Logging?: FALSE
#&gt;   ignored hosts: google.com
#&gt;   ignore localhost?: TRUE
#&gt;   Write disk path:</code></pre>
</div>
<div id="preserve_exact_body_bytes" class="section level3" number="24.3.9">
<h3>
<span class="header-section-number">24.3.9</span> preserve_exact_body_bytes<a class="anchor" aria-label="anchor" href="#preserve_exact_body_bytes"><i class="fas fa-link"></i></a>
</h3>
<p>Some HTTP servers are not well-behaved and respond with invalid data. Set
<code>preserve_exact_body_bytes</code> to <code>TRUE</code> to base64 encode the result body in
order to preserve the bytes exactly as-is. <code>vcr</code> does not do this by
default, since base64-encoding the string removes the human readability
of the cassette.</p>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span>preserve_exact_body_bytes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; &lt;vcr configuration&gt;
#&gt;   Cassette Dir: new/path
#&gt;   Record: new_episodes
#&gt;   Serialize with: yaml
#&gt;   URI Parser: urltools::url_parse
#&gt;   Match Requests on: query, headers
#&gt;   Preserve Bytes?: TRUE
#&gt;   Logging?: FALSE
#&gt;   ignored hosts: google.com
#&gt;   ignore localhost?: TRUE
#&gt;   Write disk path:</code></pre>
</div>
<div id="filter_sensitive_data" class="section level3" number="24.3.10">
<h3>
<span class="header-section-number">24.3.10</span> filter_sensitive_data<a class="anchor" aria-label="anchor" href="#filter_sensitive_data"><i class="fas fa-link"></i></a>
</h3>
<p>A named list of values to replace. Sometimes your package or script is
working with sensitive tokens/keys, which you do not want to accidentally
share with the world.</p>
<p>Before recording (writing to a cassette) we do the replacement and then when
reading from the cassette we do the reverse replacement to get back
to the real data.</p>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span></span>
<span>  filter_sensitive_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"&lt;some_api_key&gt;"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">'MY_API_KEY'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Before recording to disk, the env var <code>MY_API_KEY</code> is retrieved from your machine,
and we find instances of it, and replace with <code>&lt;some_api_key&gt;</code>. When replaying
to create the HTTP response object we put the real value of the env var
back in place.</p>
<p>To target specific request or response headers see <code>filter_request_headers</code>
and <code>filter_response_headers</code>.</p>
</div>
<div id="filter_request_headers" class="section level3" number="24.3.11">
<h3>
<span class="header-section-number">24.3.11</span> filter_request_headers<a class="anchor" aria-label="anchor" href="#filter_request_headers"><i class="fas fa-link"></i></a>
</h3>
<p>Expects a character vector or a named list. If a character vector, or any
unnamed element in a list, the request header is removed before being
written to the cassette.</p>
<p>If a named list is passed, the name is the header and the value is the
value with which to replace the real value.</p>
<p>A request header you set to remove or replace is only removed/replaced
from the cassette, and any requests using a cassette, but will still be in
your <code>crul</code>, <code>httr</code> or <code>httr2</code> response objects on a real request that creates the
cassette.</p>
<p>Examples:</p>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span></span>
<span>  filter_request_headers <span class="op">=</span> <span class="st">"Authorization"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span></span>
<span>  filter_request_headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Authorization"</span>, <span class="st">"User-Agent"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span></span>
<span>  filter_request_headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Authorization <span class="op">=</span> <span class="st">"&lt;&lt;&lt;not-my-bearer-token&gt;&gt;&gt;"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div id="filter_response_headers" class="section level3" number="24.3.12">
<h3>
<span class="header-section-number">24.3.12</span> filter_response_headers<a class="anchor" aria-label="anchor" href="#filter_response_headers"><i class="fas fa-link"></i></a>
</h3>
<p>Expects a character vector or a named list. If a character vector, or any
unnamed element in a list, the response header is removed before being
written to the cassette.</p>
<p>If a named list is passed, the name is the header and the value is the
value with which to replace the real value.</p>
<p>A response header you set to remove or replace is only removed/replaced
from the cassette, and any requests using a cassette, but will still be in
your <code>crul</code>, <code>httr</code> or <code>httr2</code> response objects on a real request that creates the
cassette.</p>
<p>Examples:</p>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span></span>
<span>  filter_response_headers <span class="op">=</span> <span class="st">"server"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span></span>
<span>  filter_response_headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"server"</span>, <span class="st">"date"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span></span>
<span>  filter_response_headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>server <span class="op">=</span> <span class="st">"fake-server"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div id="filter_query_parameters" class="section level3" number="24.3.13">
<h3>
<span class="header-section-number">24.3.13</span> filter_query_parameters<a class="anchor" aria-label="anchor" href="#filter_query_parameters"><i class="fas fa-link"></i></a>
</h3>
<p>Expects a character vector or a named list. If a character vector, or any
unnamed element in a list, the query parameter is removed (both parameter
name and value) before being written to the cassette.</p>
<p>If a named list is passed, the name is the query parameter name and the
value is the value with which to replace the real value.</p>
<p>A response header you set to remove or replace is only removed/replaced
from the cassette, and any requests using a cassette, but will still be in
your <code>crul</code>, <code>httr</code> or <code>httr2</code> response objects on a real request that creates the
cassette.</p>
<p>Beware of your <code>match_requests_on</code> option when using this filter. If you
filter out a query parameter itâs probably a bad idea to match on <code>query</code>
given that there is no way for vcr to restore the exact http request
from your cassette after one or more query parameters is removed or changed.
One way you could filter a query parameter and still match on query or
at least on the complete uri is to use replacement behavior (a named list),
but instead of <code>list(a="b")</code> use two values <code>list(a=c("b","c"))</code>, where
âcâ is the string to be stored in the cassette. You could of course replace
those values with values from environment variables so that you obscure
the real values if your code is public.</p>
<p>Examples:</p>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># completely drop parameter "user"</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span></span>
<span>  filter_query_parameters <span class="op">=</span> <span class="st">"user"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># completely drop parameters "user" and "api_key"</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span></span>
<span>  filter_query_parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"user"</span>, <span class="st">"api_key"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># replace the value of parameter "api_key" with "fake-api-key"</span></span>
<span><span class="co"># NOTE: in this case there's no way to put back any value on</span></span>
<span><span class="co"># subsequent requests, so we have to match by dropping this</span></span>
<span><span class="co"># parameter value before comparing URIs</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span></span>
<span>  filter_query_parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>api_key <span class="op">=</span> <span class="st">"fake-api-key"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># replace the value found at Sys.getenv("MY_API_KEY") of parameter</span></span>
<span><span class="co"># "api_key" with the value "foo". When using a cassette on subsequent</span></span>
<span><span class="co"># requests, we can replace "foo" with the value at Sys.getenv("MY_API_KEY")</span></span>
<span><span class="co"># before doing the URI comparison</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span></span>
<span>  filter_query_parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>api_key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"MY_API_KEY"</span><span class="op">)</span>, <span class="st">"foo"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="vcr-usage.html"><span class="header-section-number">23</span> Advanced vcr usage</a></div>
<div class="next"><a href="record-modes.html"><span class="header-section-number">25</span> Record modes</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#vcr-configuration"><span class="header-section-number">24</span> Configure vcr</a></li>
<li><a class="nav-link" href="#set-configuration-variables"><span class="header-section-number">24.1</span> Set configuration variables</a></li>
<li><a class="nav-link" href="#re-set-to-defaults"><span class="header-section-number">24.2</span> Re-set to defaults</a></li>
<li>
<a class="nav-link" href="#details-on-some-of-the-config-options"><span class="header-section-number">24.3</span> Details on some of the config options</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#dir"><span class="header-section-number">24.3.1</span> dir</a></li>
<li><a class="nav-link" href="#record"><span class="header-section-number">24.3.2</span> record</a></li>
<li><a class="nav-link" href="#match_requests_on"><span class="header-section-number">24.3.3</span> match_requests_on</a></li>
<li><a class="nav-link" href="#allow_unused_http_interactions"><span class="header-section-number">24.3.4</span> allow_unused_http_interactions</a></li>
<li><a class="nav-link" href="#serialize_with"><span class="header-section-number">24.3.5</span> serialize_with</a></li>
<li><a class="nav-link" href="#persist_with"><span class="header-section-number">24.3.6</span> persist_with</a></li>
<li><a class="nav-link" href="#ignoring-some-requests"><span class="header-section-number">24.3.7</span> ignoring some requests</a></li>
<li><a class="nav-link" href="#uri_parse"><span class="header-section-number">24.3.8</span> uri_parse</a></li>
<li><a class="nav-link" href="#preserve_exact_body_bytes"><span class="header-section-number">24.3.9</span> preserve_exact_body_bytes</a></li>
<li><a class="nav-link" href="#filter_sensitive_data"><span class="header-section-number">24.3.10</span> filter_sensitive_data</a></li>
<li><a class="nav-link" href="#filter_request_headers"><span class="header-section-number">24.3.11</span> filter_request_headers</a></li>
<li><a class="nav-link" href="#filter_response_headers"><span class="header-section-number">24.3.12</span> filter_response_headers</a></li>
<li><a class="nav-link" href="#filter_query_parameters"><span class="header-section-number">24.3.13</span> filter_query_parameters</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/ropensci-books/http-testing/blob/main/09-configuration.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/ropensci-books/http-testing/edit/main/09-configuration.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>HTTP testing in R</strong>" was written by Scott Chamberlain, MaÃ«lle Salmon. It was last built on 2024-09-04.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
