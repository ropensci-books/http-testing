<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 12 Making real requests | HTTP testing in R</title>
<meta name="author" content="Scott Chamberlain, Maëlle Salmon">
<meta name="description" content="As touched upon in the Whole Games section, it’s good to have some tests against the real API. Indeed, the web resource can change.  12.1 What can change? What can happen? An API introducing...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 12 Making real requests | HTTP testing in R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://books.ropensci.org/http-testing/real-requests-chapter.html">
<meta property="og:description" content="As touched upon in the Whole Games section, it’s good to have some tests against the real API. Indeed, the web resource can change.  12.1 What can change? What can happen? An API introducing...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 12 Making real requests | HTTP testing in R">
<meta name="twitter:description" content="As touched upon in the Whole Games section, it’s good to have some tests against the real API. Indeed, the web resource can change.  12.1 What can change? What can happen? An API introducing...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.13/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><div class="inline-figure"><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></div></noscript>
<!-- End Matomo Code --><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">HTTP testing in R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Preamble</a></li>
<li class="book-part">Introduction</li>
<li><a class="" href="http-in-r-101.html"><span class="header-section-number">2</span> HTTP in R 101</a></li>
<li><a class="" href="graceful.html"><span class="header-section-number">3</span> Graceful HTTP R packages</a></li>
<li><a class="" href="pkgs-testing-chapter.html"><span class="header-section-number">4</span> Packages for HTTP testing</a></li>
<li class="book-part">Whole Game(s)</li>
<li><a class="" href="introduction.html"><span class="header-section-number">5</span> Introduction</a></li>
<li><a class="" href="vcr.html"><span class="header-section-number">6</span> Use vcr (&amp; webmockr)</a></li>
<li><a class="" href="httptest.html"><span class="header-section-number">7</span> Use httptest</a></li>
<li><a class="" href="httptest2.html"><span class="header-section-number">8</span> Use httptest2</a></li>
<li><a class="" href="mocking-pkgs-comparison.html"><span class="header-section-number">9</span> vcr and httptest</a></li>
<li><a class="" href="webfakes.html"><span class="header-section-number">10</span> Use webfakes</a></li>
<li><a class="" href="pkgs-comparison.html"><span class="header-section-number">11</span> vcr (&amp; webmockr), httptest, webfakes</a></li>
<li class="book-part">Advanced Topics</li>
<li><a class="active" href="real-requests-chapter.html"><span class="header-section-number">12</span> Making real requests</a></li>
<li><a class="" href="cran-preparedness.html"><span class="header-section-number">13</span> CRAN- (and Bioconductor) preparedness for your tests</a></li>
<li><a class="" href="security-chapter.html"><span class="header-section-number">14</span> Security</a></li>
<li><a class="" href="errors-chapter.html"><span class="header-section-number">15</span> Faking HTTP errors</a></li>
<li><a class="" href="contributor-friendliness.html"><span class="header-section-number">16</span> Contributor friendliness</a></li>
<li class="book-part">Conclusion</li>
<li><a class="" href="conclusion-5.html"><span class="header-section-number">17</span> Conclusion</a></li>
<li class="book-part">webmockr details</li>
<li><a class="" href="mocking.html"><span class="header-section-number">18</span> Mocking HTTP Requests</a></li>
<li><a class="" href="webmockr-stubs.html"><span class="header-section-number">19</span> stubs</a></li>
<li><a class="" href="webmockr-testing.html"><span class="header-section-number">20</span> testing</a></li>
<li><a class="" href="webmockr-utilities.html"><span class="header-section-number">21</span> utilities</a></li>
<li class="book-part">vcr details</li>
<li><a class="" href="vcr-intro.html"><span class="header-section-number">22</span> Caching HTTP requests</a></li>
<li><a class="" href="vcr-usage.html"><span class="header-section-number">23</span> Advanced vcr usage</a></li>
<li><a class="" href="vcr-configuration.html"><span class="header-section-number">24</span> Configure vcr</a></li>
<li><a class="" href="record-modes.html"><span class="header-section-number">25</span> Record modes</a></li>
<li><a class="" href="request-matching.html"><span class="header-section-number">26</span> Request matching</a></li>
<li><a class="" href="debugging-your-tests-that-use-vcr.html"><span class="header-section-number">27</span> Debugging your tests that use vcr</a></li>
<li><a class="" href="vcr-security.html"><span class="header-section-number">28</span> Security with vcr</a></li>
<li><a class="" href="lightswitch.html"><span class="header-section-number">29</span> Turning vcr on and off</a></li>
<li><a class="" href="managing-cassettes.html"><span class="header-section-number">30</span> Managing cassettes</a></li>
<li><a class="" href="gotchas.html"><span class="header-section-number">31</span> Gotchas</a></li>
<li><a class="" href="session-info.html"><span class="header-section-number">32</span> Session info</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/ropensci-books/http-testing">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="real-requests-chapter" class="section level1" number="12">
<h1>
<span class="header-section-number">12</span> Making real requests<a class="anchor" aria-label="anchor" href="#real-requests-chapter"><i class="fas fa-link"></i></a>
</h1>
<p>As touched upon in the Whole Games section, it’s good to have <em>some</em> tests against the real API.
Indeed, the web resource can change.</p>
<div id="what-can-change" class="section level2" number="12.1">
<h2>
<span class="header-section-number">12.1</span> What can change?<a class="anchor" aria-label="anchor" href="#what-can-change"><i class="fas fa-link"></i></a>
</h2>
<p>What can happen?</p>
<ul>
<li>An API introducing rate-limiting;</li>
<li>A web resource disappearing;</li>
<li>etc.</li>
</ul>
</div>
<div id="how-to-make-real-requests" class="section level2" number="12.2">
<h2>
<span class="header-section-number">12.2</span> How to make real requests<a class="anchor" aria-label="anchor" href="#how-to-make-real-requests"><i class="fas fa-link"></i></a>
</h2>
<p>Maybe you can just run the same tests without using the mock files.</p>
<ul>
<li>with vcr, this behavior is <a href="https://docs.ropensci.org/vcr/reference/lightswitch.html">one environment variable away</a> (namely, <code>VCR_TURN_OFF</code>).</li>
<li>with httptest or httptest2 you can create the <a href="https://enpiar.com/r/httptest/index.html#how-do-i-switch-between-mocking-and-real-requests">same kind of behavior</a>.</li>
<li>with webfakes you can also <a href="https://r-lib.github.io/webfakes/articles/how-to.html#how-to-make-sure-that-my-code-works-with-the-real-api-">create that behavior</a>.</li>
</ul>
<p>Now this means assuming <em>all</em> your tests work with real requests.</p>
<ul>
<li>If a few tests won’t work with real requests (say they have a fixture mimicking an <a href="errors-chapter.html#errors-chapter">API error</a>, or specific answer as if today were a given date) then you can skip these tests when mocking/faking the web service is off. With vcr this means using <code><a href="https://docs.ropensci.org/vcr/reference/skip_if_vcr_off.html">vcr::skip_if_vcr_off()</a></code>; with httptest and webfakes you’d create your custom skipper.</li>
<li>If most tests won’t work with real requests, then creating a different folder for tests making real requests makes sense. It might be less unit-y as you could view these tests as integration/contract tests. Maybe they could use <a href="https://testthat.r-lib.org/articles/snapshotting.html">testthat’s snapshot testing</a> (so you could view what’s different in the API).</li>
</ul>
<div id="when-to-make-real-requests" class="section level3" number="12.2.1">
<h3>
<span class="header-section-number">12.2.1</span> When to make real requests?<a class="anchor" aria-label="anchor" href="#when-to-make-real-requests"><i class="fas fa-link"></i></a>
</h3>
<p>Locally, you might want to make real requests once in a while, in particular before a CRAN release.</p>
<p>On continuous integration you have to learn how to trigger workflows and configure build matrices to e.g.</p>
<ul>
<li>Have one build in your build matrix using real requests at each commit (this might be too much, see next section);</li>
<li>Have one scheduled workflow once a day or once a week using real requests.</li>
</ul>
</div>
</div>
<div id="why-not-make-only-or-too-many-real-requests" class="section level2" number="12.3">
<h2>
<span class="header-section-number">12.3</span> Why not make only or too many real requests?<a class="anchor" aria-label="anchor" href="#why-not-make-only-or-too-many-real-requests"><i class="fas fa-link"></i></a>
</h2>
<p>The reasons why you can’t only make real requests in your tests are the <a href="pkgs-testing-chapter.html#pkgs-testing-chapter">reasons why you are reading these book</a>:</p>
<ul>
<li>they are slower;</li>
<li>you can’t test for API errors;</li>
<li>etc.</li>
</ul>
<p>Now no matter what your setup is you don’t want to make <em>too many</em> real requests as it can be bad for the web resource and bad for you (e.g. using all your allowed requests!).
Regarding allowed requests, if possible you could however increase them by requesting for some sort of special development account if such a thing exists for the API you are working with.</p>
</div>
<div id="a-complement-to-real-requests-api-news" class="section level2" number="12.4">
<h2>
<span class="header-section-number">12.4</span> A complement to real requests: API news!<a class="anchor" aria-label="anchor" href="#a-complement-to-real-requests-api-news"><i class="fas fa-link"></i></a>
</h2>
<p>Running real requests is important to notice if something changes in the API (expected requests, responses).
Now, you can and should also follow the news of the web resource you are using in case there is something in place.</p>
<ul>
<li>Subscribe to the API newsletter if there’s one;</li>
<li>Read API changelogs if they are public;</li>
<li>In particular, if the API is developed on GitHub/GitLab/etc. you could watch the repo or subscribe to releases, so that you might ^automatically get notified.</li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="pkgs-comparison.html"><span class="header-section-number">11</span> vcr (&amp; webmockr), httptest, webfakes</a></div>
<div class="next"><a href="cran-preparedness.html"><span class="header-section-number">13</span> CRAN- (and Bioconductor) preparedness for your tests</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#real-requests-chapter"><span class="header-section-number">12</span> Making real requests</a></li>
<li><a class="nav-link" href="#what-can-change"><span class="header-section-number">12.1</span> What can change?</a></li>
<li>
<a class="nav-link" href="#how-to-make-real-requests"><span class="header-section-number">12.2</span> How to make real requests</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#when-to-make-real-requests"><span class="header-section-number">12.2.1</span> When to make real requests?</a></li></ul>
</li>
<li><a class="nav-link" href="#why-not-make-only-or-too-many-real-requests"><span class="header-section-number">12.3</span> Why not make only or too many real requests?</a></li>
<li><a class="nav-link" href="#a-complement-to-real-requests-api-news"><span class="header-section-number">12.4</span> A complement to real requests: API news!</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/ropensci-books/http-testing/blob/main/topics-real.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/ropensci-books/http-testing/edit/main/topics-real.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>HTTP testing in R</strong>" was written by Scott Chamberlain, Maëlle Salmon. It was last built on 2022-03-14.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
