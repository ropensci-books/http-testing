#  (PART) Whole Game(s) {-}

# Introduction

Similar to the [Whole Game chapter in the R packages book by Hadley Wickham and Jenny Bryan](https://r-pkgs.org/whole-game.html), we shall go through how to add HTTP tests to a minimal package.
However, we will do it _three_ times to present alternative approaches.
After that exercise, we shall compare approaches.
The next section will then present single topics such as "how to deal with authentication" in further details.

## Our example package

Our minimal package, [`examplighratia`](https://github.com/maelle/exemplighratia), accesses the GitHub status API and one endpoint of GitHub V3 REST API.
It is named after the Latin phrase _exempli gratia_ that means "for instance", with an H for GH.
If you really need to interact with GitHub V3 API, we recommend the `{gh}` package.
We also recommend looking at the source of the gh package, and at the docs of GitHub V3 API, in particular about [authentication](https://developer.github.com/v3/#authentication).

GitHub V3 API works without authentication too, but at a lower rate.
For the sake of simplicity we shall assume it does not work without authentication.
Authentication is the setting of a token in a HTTP header, so no OAuth dance or so. 

GitHub Status API, on the contrary, does not necessitate authentication at all.

So we have two functions, one that works without authentication, one that works with authentication.

How did we create the package?
You are obviously free to use your own favorite workflow tools!

* We followed `{usethis}` setup article.
* `usethis::create_package("path/to/folder/exemplighratia")`
* `usethis::use_package("httr")`
* `usethis::use_package("purrr")`
* To add the first function, `use_r("api-status.R")`

```r
status_url <- function() {
  "https://kctbh9vrtdwd.statuspage.io/api/v2/components.json"
}

#' GitHub APIs status
#'
#' @description Get the status of requests to GitHub APIs
#'
#' @return A character vector, one of "operational", "degraded_performance",
#' "partial_outage", or "major_outage."
#'
#' @details See details in https://www.githubstatus.com/api#components.
#' @export
#'
#' @examples
#' \dontrun{
#' gh_api_status()
#' }
gh_api_status <- function() {
  response <- httr::GET(status_url())

  # Check status
  httr::stop_for_status(response)

  # Parse the content
  content <- httr::content(response)

  # Extract the part about the API status
  components <- content$components
  api_status <- components[purrr::map_chr(components, "name") == "API Requests"][[1]]

  # Return status
  api_status$status

}
```

* To add a simple test, `use_test("api-status")` (and using testthat dev version so setting `Config/testthat/edition: 3` in `DESCRIPTION`).

```r
test_that("gh_api_status() works", {
  testthat::expect_type(gh_api_status(), "character")
})
```

* To add a second function, `use_r("organizations.R")`.