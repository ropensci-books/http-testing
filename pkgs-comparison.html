<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 11 vcr (&amp; webmockr), httptest, webfakes | HTTP testing in R</title>
<meta name="author" content="Scott Chamberlain, Maëlle Salmon">
<meta name="description" content="We’re now at a nice stage where we have made a demo of usage for each of the HTTP testing packages, in our exemplighratia package. Of course, the choice of strategy in the demo is a bit...">
<meta name="generator" content="bookdown 0.37 with bs4_book()">
<meta property="og:title" content="Chapter 11 vcr (&amp; webmockr), httptest, webfakes | HTTP testing in R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://books.ropensci.org/http-testing/pkgs-comparison.html">
<meta property="og:description" content="We’re now at a nice stage where we have made a demo of usage for each of the HTTP testing packages, in our exemplighratia package. Of course, the choice of strategy in the demo is a bit...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 11 vcr (&amp; webmockr), httptest, webfakes | HTTP testing in R">
<meta name="twitter:description" content="We’re now at a nice stage where we have made a demo of usage for each of the HTTP testing packages, in our exemplighratia package. Of course, the choice of strategy in the demo is a bit...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.6.1/transition.js"></script><script src="libs/bs3compat-0.6.1/tabs.js"></script><script src="libs/bs3compat-0.6.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><div class="inline-figure"><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></div></noscript>
<!-- End Matomo Code --><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">HTTP testing in R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Preamble</a></li>
<li class="book-part">Introduction</li>
<li><a class="" href="http-in-r-101.html"><span class="header-section-number">2</span> HTTP in R 101</a></li>
<li><a class="" href="graceful.html"><span class="header-section-number">3</span> Graceful HTTP R packages</a></li>
<li><a class="" href="pkgs-testing-chapter.html"><span class="header-section-number">4</span> Packages for HTTP testing</a></li>
<li class="book-part">Whole Game(s)</li>
<li><a class="" href="introduction.html"><span class="header-section-number">5</span> Introduction</a></li>
<li><a class="" href="vcr.html"><span class="header-section-number">6</span> Use vcr (&amp; webmockr)</a></li>
<li><a class="" href="httptest.html"><span class="header-section-number">7</span> Use httptest</a></li>
<li><a class="" href="mocking-pkgs-comparison.html"><span class="header-section-number">8</span> vcr and httptest</a></li>
<li><a class="" href="httptest2.html"><span class="header-section-number">9</span> Use httptest2</a></li>
<li><a class="" href="webfakes.html"><span class="header-section-number">10</span> Use webfakes</a></li>
<li><a class="active" href="pkgs-comparison.html"><span class="header-section-number">11</span> vcr (&amp; webmockr), httptest, webfakes</a></li>
<li class="book-part">Advanced Topics</li>
<li><a class="" href="real-requests-chapter.html"><span class="header-section-number">12</span> Making real requests</a></li>
<li><a class="" href="cran-preparedness.html"><span class="header-section-number">13</span> CRAN- (and Bioconductor) preparedness for your tests</a></li>
<li><a class="" href="security-chapter.html"><span class="header-section-number">14</span> Security</a></li>
<li><a class="" href="errors-chapter.html"><span class="header-section-number">15</span> Faking HTTP errors</a></li>
<li><a class="" href="contributor-friendliness.html"><span class="header-section-number">16</span> Contributor friendliness</a></li>
<li class="book-part">Conclusion</li>
<li><a class="" href="conclusion-5.html"><span class="header-section-number">17</span> Conclusion</a></li>
<li class="book-part">webmockr details</li>
<li><a class="" href="mocking.html"><span class="header-section-number">18</span> Mocking HTTP Requests</a></li>
<li><a class="" href="webmockr-stubs.html"><span class="header-section-number">19</span> stubs</a></li>
<li><a class="" href="webmockr-testing.html"><span class="header-section-number">20</span> testing</a></li>
<li><a class="" href="webmockr-utilities.html"><span class="header-section-number">21</span> utilities</a></li>
<li class="book-part">vcr details</li>
<li><a class="" href="vcr-intro.html"><span class="header-section-number">22</span> Caching HTTP requests</a></li>
<li><a class="" href="vcr-usage.html"><span class="header-section-number">23</span> Advanced vcr usage</a></li>
<li><a class="" href="vcr-configuration.html"><span class="header-section-number">24</span> Configure vcr</a></li>
<li><a class="" href="record-modes.html"><span class="header-section-number">25</span> Record modes</a></li>
<li><a class="" href="request-matching.html"><span class="header-section-number">26</span> Request matching</a></li>
<li><a class="" href="debugging-your-tests-that-use-vcr.html"><span class="header-section-number">27</span> Debugging your tests that use vcr</a></li>
<li><a class="" href="vcr-security.html"><span class="header-section-number">28</span> Security with vcr</a></li>
<li><a class="" href="lightswitch.html"><span class="header-section-number">29</span> Turning vcr on and off</a></li>
<li><a class="" href="managing-cassettes.html"><span class="header-section-number">30</span> Managing cassettes</a></li>
<li><a class="" href="gotchas.html"><span class="header-section-number">31</span> Gotchas</a></li>
<li><a class="" href="session-info.html"><span class="header-section-number">32</span> Session info</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/ropensci-books/http-testing">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="pkgs-comparison" class="section level1" number="11">
<h1>
<span class="header-section-number">11</span> vcr (&amp; webmockr), httptest, webfakes<a class="anchor" aria-label="anchor" href="#pkgs-comparison"><i class="fas fa-link"></i></a>
</h1>
<p>We’re now at a nice stage where we have made a demo of usage for each of the HTTP testing packages, in our exemplighratia package.
Of course, the choice of strategy in the demo is a bit subjective, but we hope it showed the best of each tool.</p>
<div class="alert alert-dismissible alert-primary">
<p>A first message that’s important to us: if you’re learning about HTTP testing and using it in a branch of your own package sounds daunting, create a minimal package for playing!</p>
</div>
<div id="what-http-client-can-you-use-curl-httr-crul" class="section level2" number="11.1">
<h2>
<span class="header-section-number">11.1</span> What HTTP client can you use (curl, httr, crul)<a class="anchor" aria-label="anchor" href="#what-http-client-can-you-use-curl-httr-crul"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>httptest only works with httr (the most popular HTTP R client);</li>
<li>vcr (&amp; webmockr) works with both httr and crul (the two “high-level” HTTP R clients);</li>
<li>webfakes works with any R HTTP client, even base R if you wish.</li>
</ul>
</div>
<div id="sustainability-of-the-packages" class="section level2" number="11.2">
<h2>
<span class="header-section-number">11.2</span> Sustainability of the packages<a class="anchor" aria-label="anchor" href="#sustainability-of-the-packages"><i class="fas fa-link"></i></a>
</h2>
<p>All packages (vcr, webmockr, httptest, webfakes) are actively maintained.
During the writing of this book, issues and pull requests were tackled rather quickly, and always in a very nice way.</p>
</div>
<div id="test-writing-experience" class="section level2" number="11.3">
<h2>
<span class="header-section-number">11.3</span> Test writing experience<a class="anchor" aria-label="anchor" href="#test-writing-experience"><i class="fas fa-link"></i></a>
</h2>
<p>In all cases having HTTP tests, i.e. tests that work independently from any internet connection, depends on</p>
<ul>
<li>setup, which is mainly adding a dependency on the HTTP testing packages in DESCRIPTION, and a setup or helper file;</li>
<li>providing responses from the API.</li>
</ul>
<p>The difference between packages, the <em>test writing experience</em> depends on how you can provide responses from the API, both real ones and fake ones.</p>
<p>With vcr and httptest for tests testing <em>normal behavior</em>, after set up (for which there is a helper function), testing is just a function away (<code><a href="https://docs.ropensci.org/vcr/reference/use_cassette.html">vcr::use_cassette()</a></code>, <code><a href="https://enpiar.com/r/httptest/reference/with_mock_dir.html">httptest::with_mock_dir()</a></code>, <code><a href="https://enpiar.com/r/httptest/reference/with_mock_api.html">httptest::with_mock_api()</a></code>).
Recording happens automatically during the first run of tests.
You might also provide fake recorded response or dumb down the existing ones.
For creating <em>API errors</em>, and API sequence of responses (e.g. 502 then 200), you end up either using webmockr, or amending mock files, see <a href="https://docs.ropensci.org/vcr/articles/cassette-manual-editing.html">vcr</a> and httptest related docs.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Sequence of requests are not &lt;a href="https://github.com/nealrichardson/httptest/issues/49"&gt;supported smoothly yet by httptest&lt;/a&gt;.&lt;/p&gt;'><sup>5</sup></a></p>
<p>With webfakes you need to create an app.
There could be one per test, per test file or for the whole test suite.
It might seem like more overhead code but being able to share an app between different tests reduces this effort.
You can test for an <a href="https://r-lib.github.io/webfakes/dev/articles/how-to.html#how-do-i-test-a-sequence-of-requests-">API sequence of responses (e.g. 502 then 200)</a> by following an how-to.
The one thing that’s not supported in webfakes yet is a smooth workflow for recording responses, so at the time of writing you might need to write your own workflow for recording responses.</p>
<p><strong>In general setup&amp;test writing might be easier for packages with mocking (vcr and httptest) but you might be able to replicate more complex behavior with webfakes (such as an <a href="https://r-lib.github.io/webfakes/articles/oauth.html">OAuth dance</a>).</strong></p>
<div id="the-special-case-of-secrets" class="section level3" number="11.3.1">
<h3>
<span class="header-section-number">11.3.1</span> The special case of secrets<a class="anchor" aria-label="anchor" href="#the-special-case-of-secrets"><i class="fas fa-link"></i></a>
</h3>
<p>With webfakes as no authentication is needed at any point, you have less chance of exposing a secret.</p>
<p>With httptest only the body of responses is saved, so unless it contains secrets, no further effort is needed. If you <em>need</em> to redact mock files, see <a href="https://enpiar.com/r/httptest/articles/redacting.html">the corresponding vignette</a>.</p>
<p>With vcr as all HTTP interactions, including request URLs and headers, are saved to disk, you will most often have to use the <code>filter_sensitive_data</code>, <code>filter_request_header</code> and/or <code>filter_response_header</code> arguments of <code><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr::vcr_configure()</a></code>.</p>
</div>
<div id="how-about-making-real-requests" class="section level3" number="11.3.2">
<h3>
<span class="header-section-number">11.3.2</span> How about making real requests<a class="anchor" aria-label="anchor" href="#how-about-making-real-requests"><i class="fas fa-link"></i></a>
</h3>
<p>In all three cases, switching back to real requests might be an environment variable away (turning vcr off, setting the URL of the real web service as URL to be connected to instead of a webfakes fake web service).
However, your tests using fixed/fake responses / a fake web service might not work with real requests as you can’t trigger an API error, and as you might test for specific values in your tests using mock files whereas the API returns something different every day.
Therefore, and it’s a challenge common to all three packages, you might need to choose to have <em>distinct</em> tests as integration tests/<a href="https://www.martinfowler.com/bliki/ContractTest.html">contract tests</a>.
See also our chapter about <a href="real-requests-chapter.html#real-requests-chapter">making real requests</a>.</p>
</div>
</div>
<div id="test-debugging-experience" class="section level2" number="11.4">
<h2>
<span class="header-section-number">11.4</span> Test debugging experience<a class="anchor" aria-label="anchor" href="#test-debugging-experience"><i class="fas fa-link"></i></a>
</h2>
<p>Sadly sometimes one needs to run code from the tests in an interactive session, either to debug tests after making a code change, or to learn how to write HTTP tests.</p>
<p>With webfakes, debugging works this way: load the helper or test file where</p>
<ul>
<li>the app is created,</li>
<li>the environment variable connecting your package code to the fake web service is changed.</li>
</ul>
<p>Then run your code. To debug <em>webfakes apps</em>, follow the <a href="https://r-lib.github.io/webfakes/dev/articles/how-to.html#how-can-i-debug-an-app-">guidance</a>.</p>
<p>With vcr, refer to the <a href="https://docs.ropensci.org/vcr/articles/debugging.html">debugging</a> vignette: you’ll have to load the helper file or source the setup file after making sure the paths use in it work both from <code>tests/testthat/</code> and the package root (see <code><a href="https://docs.ropensci.org/vcr/reference/vcr_test_path.html">?vcr::vcr_test_path</a></code>), and then use <code>vcr::inject_cassette()</code>; don’t forget to run <code><a href="https://docs.ropensci.org/vcr/reference/eject_cassette.html">vcr::eject_cassette()</a></code> afterwards.
With webmockr debugging is quite natural, run the code that’s in the test, in particular <code><a href="https://docs.ropensci.org/webmockr/reference/enable.html">webmockr::enable()</a></code> and <code><a href="https://docs.ropensci.org/webmockr/reference/enable.html">webmockr::disable()</a></code>.</p>
<p>With httptest, the process is similar as with vcr except the key functions are</p>
<ul>
<li><a href="https://enpiar.com/r/httptest/reference/use_mock_api.html"><code>use_mock_api()</code></a></li>
<li>
<a href="https://enpiar.com/r/httptest/reference/mockPaths.html">.mockPaths</a>.</li>
</ul>
</div>
<div id="conclusion-4" class="section level2" number="11.5">
<h2>
<span class="header-section-number">11.5</span> Conclusion<a class="anchor" aria-label="anchor" href="#conclusion-4"><i class="fas fa-link"></i></a>
</h2>
<p>In this chapter we compared the three R packages that make HTTP testing easier.
If you are still unsure which one to pick, first try packages out without commitment, in branches or so, but then choose one and <a href="https://vickiboykis.com/2019/02/10/commit-to-your-lock-in/">commit to your lock-in</a>.</p>
<blockquote>
<p>“Every piece of code written in a given language or framework is a step away from any other language, and five more minutes you’ll have to spend migrating it to something else. That’s fine. You just have to decide what you’re willing to be locked into.</p>
<p>(…)</p>
<p>Code these days becomes obsolete so quickly, regardless of what’s chosen. By the time your needs change, by the time the latest framework is obsolete, all of the code will be rotten anyway</p>
<p>(…)</p>
<p>The most dangerous feature about these articles examining cloud lock-in is that they introduce a kind of paralysis into teams that result in applications never being completely fleshed out or finished.”</p>
<p>Vicki Boykis, “Commit to your lock-in”.</p>
</blockquote>

</div>
</div>




  <div class="chapter-nav">
<div class="prev"><a href="webfakes.html"><span class="header-section-number">10</span> Use webfakes</a></div>
<div class="next"><a href="real-requests-chapter.html"><span class="header-section-number">12</span> Making real requests</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#pkgs-comparison"><span class="header-section-number">11</span> vcr (&amp; webmockr), httptest, webfakes</a></li>
<li><a class="nav-link" href="#what-http-client-can-you-use-curl-httr-crul"><span class="header-section-number">11.1</span> What HTTP client can you use (curl, httr, crul)</a></li>
<li><a class="nav-link" href="#sustainability-of-the-packages"><span class="header-section-number">11.2</span> Sustainability of the packages</a></li>
<li>
<a class="nav-link" href="#test-writing-experience"><span class="header-section-number">11.3</span> Test writing experience</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#the-special-case-of-secrets"><span class="header-section-number">11.3.1</span> The special case of secrets</a></li>
<li><a class="nav-link" href="#how-about-making-real-requests"><span class="header-section-number">11.3.2</span> How about making real requests</a></li>
</ul>
</li>
<li><a class="nav-link" href="#test-debugging-experience"><span class="header-section-number">11.4</span> Test debugging experience</a></li>
<li><a class="nav-link" href="#conclusion-4"><span class="header-section-number">11.5</span> Conclusion</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/ropensci-books/http-testing/blob/main/wholegames-comparison.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/ropensci-books/http-testing/edit/main/wholegames-comparison.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>HTTP testing in R</strong>" was written by Scott Chamberlain, Maëlle Salmon. It was last built on 2024-02-01.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
