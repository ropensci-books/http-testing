<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 28 Security with vcr | HTTP testing in R</title>
<meta name="author" content="Scott Chamberlain, Maëlle Salmon">
<meta name="description" content="Refer to the security chapter for more general guidance.  28.1 Keeping secrets safe To keep your secrets safe, you need to use parameters of vcr::vcr_configure() that tell vcr either where secrets...">
<meta name="generator" content="bookdown 0.37 with bs4_book()">
<meta property="og:title" content="Chapter 28 Security with vcr | HTTP testing in R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://books.ropensci.org/http-testing/vcr-security.html">
<meta property="og:description" content="Refer to the security chapter for more general guidance.  28.1 Keeping secrets safe To keep your secrets safe, you need to use parameters of vcr::vcr_configure() that tell vcr either where secrets...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 28 Security with vcr | HTTP testing in R">
<meta name="twitter:description" content="Refer to the security chapter for more general guidance.  28.1 Keeping secrets safe To keep your secrets safe, you need to use parameters of vcr::vcr_configure() that tell vcr either where secrets...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.6.1/transition.js"></script><script src="libs/bs3compat-0.6.1/tabs.js"></script><script src="libs/bs3compat-0.6.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><div class="inline-figure"><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></div></noscript>
<!-- End Matomo Code --><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">HTTP testing in R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Preamble</a></li>
<li class="book-part">Introduction</li>
<li><a class="" href="http-in-r-101.html"><span class="header-section-number">2</span> HTTP in R 101</a></li>
<li><a class="" href="graceful.html"><span class="header-section-number">3</span> Graceful HTTP R packages</a></li>
<li><a class="" href="pkgs-testing-chapter.html"><span class="header-section-number">4</span> Packages for HTTP testing</a></li>
<li class="book-part">Whole Game(s)</li>
<li><a class="" href="introduction.html"><span class="header-section-number">5</span> Introduction</a></li>
<li><a class="" href="vcr.html"><span class="header-section-number">6</span> Use vcr (&amp; webmockr)</a></li>
<li><a class="" href="httptest.html"><span class="header-section-number">7</span> Use httptest</a></li>
<li><a class="" href="mocking-pkgs-comparison.html"><span class="header-section-number">8</span> vcr and httptest</a></li>
<li><a class="" href="httptest2.html"><span class="header-section-number">9</span> Use httptest2</a></li>
<li><a class="" href="webfakes.html"><span class="header-section-number">10</span> Use webfakes</a></li>
<li><a class="" href="pkgs-comparison.html"><span class="header-section-number">11</span> vcr (&amp; webmockr), httptest, webfakes</a></li>
<li class="book-part">Advanced Topics</li>
<li><a class="" href="real-requests-chapter.html"><span class="header-section-number">12</span> Making real requests</a></li>
<li><a class="" href="cran-preparedness.html"><span class="header-section-number">13</span> CRAN- (and Bioconductor) preparedness for your tests</a></li>
<li><a class="" href="security-chapter.html"><span class="header-section-number">14</span> Security</a></li>
<li><a class="" href="errors-chapter.html"><span class="header-section-number">15</span> Faking HTTP errors</a></li>
<li><a class="" href="contributor-friendliness.html"><span class="header-section-number">16</span> Contributor friendliness</a></li>
<li class="book-part">Conclusion</li>
<li><a class="" href="conclusion-5.html"><span class="header-section-number">17</span> Conclusion</a></li>
<li class="book-part">webmockr details</li>
<li><a class="" href="mocking.html"><span class="header-section-number">18</span> Mocking HTTP Requests</a></li>
<li><a class="" href="webmockr-stubs.html"><span class="header-section-number">19</span> stubs</a></li>
<li><a class="" href="webmockr-testing.html"><span class="header-section-number">20</span> testing</a></li>
<li><a class="" href="webmockr-utilities.html"><span class="header-section-number">21</span> utilities</a></li>
<li class="book-part">vcr details</li>
<li><a class="" href="vcr-intro.html"><span class="header-section-number">22</span> Caching HTTP requests</a></li>
<li><a class="" href="vcr-usage.html"><span class="header-section-number">23</span> Advanced vcr usage</a></li>
<li><a class="" href="vcr-configuration.html"><span class="header-section-number">24</span> Configure vcr</a></li>
<li><a class="" href="record-modes.html"><span class="header-section-number">25</span> Record modes</a></li>
<li><a class="" href="request-matching.html"><span class="header-section-number">26</span> Request matching</a></li>
<li><a class="" href="debugging-your-tests-that-use-vcr.html"><span class="header-section-number">27</span> Debugging your tests that use vcr</a></li>
<li><a class="active" href="vcr-security.html"><span class="header-section-number">28</span> Security with vcr</a></li>
<li><a class="" href="lightswitch.html"><span class="header-section-number">29</span> Turning vcr on and off</a></li>
<li><a class="" href="managing-cassettes.html"><span class="header-section-number">30</span> Managing cassettes</a></li>
<li><a class="" href="gotchas.html"><span class="header-section-number">31</span> Gotchas</a></li>
<li><a class="" href="session-info.html"><span class="header-section-number">32</span> Session info</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/ropensci-books/http-testing">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="vcr-security" class="section level1" number="28">
<h1>
<span class="header-section-number">28</span> Security with vcr<a class="anchor" aria-label="anchor" href="#vcr-security"><i class="fas fa-link"></i></a>
</h1>
<p>Refer to <a href="security-chapter.html#security-chapter">the security chapter</a> for more general guidance.</p>
<div id="api-keys-security" class="section level2" number="28.1">
<h2>
<span class="header-section-number">28.1</span> Keeping secrets safe<a class="anchor" aria-label="anchor" href="#api-keys-security"><i class="fas fa-link"></i></a>
</h2>
<p>To keep your secrets safe, you need to use parameters of <code><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr::vcr_configure()</a></code> that tell vcr either where secrets are (and what to put in their place), or what secrets are (and what to put in their place).
It is best if you know how secrets are used in requests: e.g. is the API key passed as a header or part of the query string?
Maybe you will need different strategies for the different secrets (e.g. an OAuth2.0 access token will be set as Authorization header but an OAuth2.0 refresh token might be in a query string).</p>
<p>In all cases, it is crucial to look at your cassettes before putting them on the public web, just to be sure you got the configuration right!</p>
<div id="if-the-secret-is-in-a-request-header" class="section level3" number="28.1.1">
<h3>
<span class="header-section-number">28.1.1</span> If the secret is in a request header<a class="anchor" aria-label="anchor" href="#if-the-secret-is-in-a-request-header"><i class="fas fa-link"></i></a>
</h3>
<p>You can use <code>filter_request_headers</code>!</p>
<p>There are different ways to use it.</p>
<div class="sourceCode" id="cb151"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Remove one header from the cassettes</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span></span>
<span>  filter_request_headers <span class="op">=</span> <span class="st">"Authorization"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove two headers from the cassettes</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span></span>
<span>  filter_request_headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Authorization"</span>, <span class="st">"User-Agent"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Replace one header with a given string</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span></span>
<span>  filter_request_headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Authorization <span class="op">=</span> <span class="st">"&lt;&lt;&lt;not-my-bearer-token&gt;&gt;&gt;"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div id="if-the-secret-is-in-a-response-header" class="section level3" number="28.1.2">
<h3>
<span class="header-section-number">28.1.2</span> If the secret is in a response header<a class="anchor" aria-label="anchor" href="#if-the-secret-is-in-a-response-header"><i class="fas fa-link"></i></a>
</h3>
<p>You can use <code>filter_response_headers</code> that works like <code>filter_request_headers</code>.</p>
</div>
<div id="if-the-secret-is-somewhere-else" class="section level3" number="28.1.3">
<h3>
<span class="header-section-number">28.1.3</span> If the secret is somewhere else<a class="anchor" aria-label="anchor" href="#if-the-secret-is-somewhere-else"><i class="fas fa-link"></i></a>
</h3>
<p>In this case you need to tell vcr what the secret string is via <code>filter_sensitive_data</code>.
Do not write the secret string directly in the configuration, that’d defeat the purpose of protecting it!
Have the secret in an environment variable for instance and tell vcr to read it from there.</p>
<p>The configuration parameter <code>filter_sensitive_data</code> accepts a named list.</p>
<p>Each element in the list should be of the following format:</p>
<p><code>thing_to_replace_it_with = thing_to_replace</code></p>
<p>We replace all instances of <code>thing_to_replace</code> with <code>thing_to_replace_it_with</code>.</p>
<p>Before recording (writing to a cassette) we do the replacement and then when
reading from the cassette we do the reverse replacement to get back
to the real data.</p>
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span></span>
<span>  filter_sensitive_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"&lt;&lt;&lt;my_api_key&gt;&gt;&gt;"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">'API_KEY'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>You want to make the string that replaces your sensitive string something that
won’t be easily found elsewhere in the response body/headers/etc.</p>
</div>
</div>
<div id="different-api-keys" class="section level2" number="28.2">
<h2>
<span class="header-section-number">28.2</span> API keys and tests run in varied contexts<a class="anchor" aria-label="anchor" href="#different-api-keys"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>For real requests a real API key is needed.</li>
<li>For requests using cassettes a fake API key is needed to fool your package. That is
why in our <a href="vcr.html#vcr">demo of vcr</a> we set a fake API key in a test setup file.</li>
</ul>
</div>
<div id="other-security" class="section level2" number="28.3">
<h2>
<span class="header-section-number">28.3</span> Other security<a class="anchor" aria-label="anchor" href="#other-security"><i class="fas fa-link"></i></a>
</h2>
<p>Let us know about any other security concerns! Surely there’s things we haven’t
considered yet.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="debugging-your-tests-that-use-vcr.html"><span class="header-section-number">27</span> Debugging your tests that use vcr</a></div>
<div class="next"><a href="lightswitch.html"><span class="header-section-number">29</span> Turning vcr on and off</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#vcr-security"><span class="header-section-number">28</span> Security with vcr</a></li>
<li>
<a class="nav-link" href="#api-keys-security"><span class="header-section-number">28.1</span> Keeping secrets safe</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#if-the-secret-is-in-a-request-header"><span class="header-section-number">28.1.1</span> If the secret is in a request header</a></li>
<li><a class="nav-link" href="#if-the-secret-is-in-a-response-header"><span class="header-section-number">28.1.2</span> If the secret is in a response header</a></li>
<li><a class="nav-link" href="#if-the-secret-is-somewhere-else"><span class="header-section-number">28.1.3</span> If the secret is somewhere else</a></li>
</ul>
</li>
<li><a class="nav-link" href="#different-api-keys"><span class="header-section-number">28.2</span> API keys and tests run in varied contexts</a></li>
<li><a class="nav-link" href="#other-security"><span class="header-section-number">28.3</span> Other security</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/ropensci-books/http-testing/blob/main/13-security.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/ropensci-books/http-testing/edit/main/13-security.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>HTTP testing in R</strong>" was written by Scott Chamberlain, Maëlle Salmon. It was last built on 2024-02-02.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
